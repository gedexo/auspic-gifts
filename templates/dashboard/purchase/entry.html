{% extends 'dashboard/base.html' %} 
{% load static %}
{% block title %}{{title}}{% endblock%} 

{% block content %}
<div class="row mb-8">
  <div class="col-md-12">
    <div class="d-md-flex justify-content-between align-items-center">
      <div>
        <h2>{{title}}</h2>
      </div>
      <div class="mt-5 mt-md-0">
        <a onclick="history.back()" class="btn btn-light">Back to Purchase</a>
      </div>
    </div>
  </div>
</div>
<form method="POST" enctype="multipart/form-data" class="ajax redirect skip_empty_row not_allowed_without_formset" data-redirect="{% url 'main:purchase_list' %}">
  {% csrf_token %}
  <div class="row">
    <div class="col-lg-10 col-12">
      <div class="card mb-6 card-lg">
        <div class="card-body p-6 ">
          
          <div class=" mt-2 row">
            <!-- input -->
            <div class="mb-3 col-md-6">
              <label class="form-label">{{form.date.label}} {% if form.date.field.required %}<span class="text-danger">*</span>{% endif %} </label>
              {{ form.date }}
            </div>
            <div class="mb-3 col-md-6">
              <label class="form-label">{{form.voucher_number.label}} {% if form.voucher_number.field.required %}<span class="text-danger">*</span>{% endif %}</label>
              {{form.voucher_number}}
            </div>
            
            <div class="mb-3 col-md-12">
              <label class="form-label">{{form.description.label}} {% if form.description.field.required %}<span class="text-danger">*</span>{% endif %}</label>
              {{form.description}}
            </div>
          </div>
        </div>
      </div>
    </div>
   
  </div>
 
  <div class="row">
    <div class="col-md-12">
      <div class="card mb-6 card-lg">
        <div class="card-body p-6 ">
          <h4 class="mb-3 h5">Product Available Size & Price</h4>
          <div class=" products_formset table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th >Product</th>
                  <th >quantity</th>
                  <th width=""></th>
                </tr>
              </thead>
              <tbody>
                {% for form in products_formset %}
                {{form.id}}
                <tr class=" form_set_row ">
                  <td  style="vertical-align: middle; padding: 5px 10px;"><span class="check_empty">{{form.product_varient}}</span></td>
                  <td  style="vertical-align: middle; padding: 5px 10px;">{{form.quantity}}</td>
                  <td style="vertical-align: middle;"></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  {{ products_formset.management_form }}
  <div class="col-md-5">
    <button style="width:60%" type="submit" class="btn btn-primary">Submit</button>
 </div>
</form>
{% endblock content %}

{% block css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.2.0/css/material-design-iconic-font.min.css">
<style>
  .btn-icon {
    border-radius: 50%;
    width: 40px;
    line-height: 40px !important;
    height: 40px;
    padding: 0;
    text-align: center;
    display: inline-block;
  }
  .waves-effect {
    position: relative;
    cursor: pointer;
    display: inline-block;
    overflow: hidden;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.16), 0 2px 10px rgba(0, 0, 0, 0.12);
}
.dynamic-formset1-add td {
    text-align: center;
}
</style>
{% endblock%}

{% block js_plugins %}
<script src="{% static 'app/js/formset.js' %}"></script>
{% include 'web/includes/form-ajax.html' %}
<script>
  $(document).ready(function () {
    $('.products_formset table tr.form_set_row').formset({
      prefix:'{{products_formset.prefix}}',
      formCssClass: 'dynamic-formset1',
      'added' : function (row) {
      }
    })
    

    $(document).on('click','.form_set_row .icon-trash', function(){
      var $this = $(this);
      $parent_table = $this.parents('table');
      var length = $parent_table.find('tr').length;
      if(length > 3){
        $this.parents('tr').remove();
      }
    });
    $('.add_item_container .icon_add_item').click(function(){
      var $nearTable = $(this).parents('.add_item_container').find('table');
      var $second_last_tr = $nearTable.find('tr:nth-last-child(2)');
      var rowTemp = $nearTable.find('tr:nth-last-child(2)').html();
      $second_last_tr.after('<tr class="form_set_row">' + rowTemp + '</tr>');
      $second_last_tr.find('tr:last-child input').removeAttr('id');
    });
  });
</script>
{{products_formset.media}}
{{form.media}}
{% endblock %}

