{% load static i18n %}
{% get_current_language as LANGUAGE_CODE %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" class="">
    {% load static %}
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
 
    <title> auspic</title>
  
    <link rel="shortcut icon" href="{% static 'web/images/logo/logo.png' %}">

 
  
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  
    <link rel="stylesheet" href="{% static 'web/css/select2.min.css' %}">

    <link rel="stylesheet" href="{% static 'web/css/slick.css' %}">
  
    <link rel="stylesheet" href="{% static 'web/css/jquery-ui.css' %}">
    <link rel="stylesheet" href="{% static 'web/css/custom.css' %}?v=1.2">
   
    <link rel="stylesheet" href="{% static 'web/css/main.css' %}?v=1.2">
    

    {% block css_plugins %}
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"> <!-- For icons -->

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.0/dist/sweetalert2.min.css">

    {% endblock %}
    {% block css %}{% endblock %}
    <style>
        {% if LANGUAGE_CODE == 'ar' %}
        @media screen and (max-width: 991px) {
            .responsive-dropdown {
                position: fixed;
                inset-inline-start: 0;
                inset-block-start: 0;
                visibility: visible;
                opacity: 1;
                margin-top: 0;
                border-radius: 0;
                width: unset !important;
                height: 100vh;
                overflow-y: auto;
                transform: translateY(-100%);
                padding-top: 8px !important;
            }
        }
        .toggle-mobileMenu {
            margin-right: auto;
        }
        .toggle-mobileMenu {
            margin-left: inherit;
        }
        .mobile-menu {
            position: fixed;
            background-color: hsl(var(--white));
            width: 300px;
            height: 100vh;
            overflow-y: auto;
            padding: 24px;
            z-index: 991;
            transform: translateY(-100%);
            transition: 0.2s linear;
            padding-block-end: 68px;
        }
       
        {% endif %}
    </style>

</head> 
<body dir="{% if LANGUAGE_CODE == 'ar' %}rtl{% else %}ltr{% endif %}">

    <!-- Skeleton loading screen -->
    <div id="skeletonLoader" class="skeleton-container">
        <div class="container container-lg">
            <div class="skeleton skeleton-header"></div>
            <div class="skeleton skeleton-banner"></div>
            
            <div class="skeleton-feature">
                {% for i in "12345678" %}
                <div class="skeleton skeleton-feature-item"></div>
                {% endfor %}
            </div>
            
            <div class="skeleton skeleton-section-title"></div>
            <div class="skeleton-product-grid">
                {% for i in "123456" %}
                <div class="skeleton skeleton-product-card"></div>
                {% endfor %}
            </div>
            
            <div class="skeleton skeleton-promo"></div>
            
            <div class="skeleton skeleton-section-title"></div>
            <div class="skeleton-product-grid">
                {% for i in "123456" %}
                <div class="skeleton skeleton-product-card"></div>
                {% endfor %}
            </div>
            
            <div class="skeleton skeleton-footer"></div>
        </div>
    </div>

    <div id="mainContent">
        {% include 'web/includes/header.html' %}
        {% block content %}{% endblock %} 
        {% include 'web/includes/footer.html' %}
    </div>


  
    <script src="{% static 'web/js/jquery-3.7.1.min.js' %}"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  
    <script src="{% static 'web/js/phosphor-icon.js' %}"></script>
   
    <script src="{% static 'web/js/select2.min.js' %}"></script>
    
    <script src="{% static 'web/js/slick.min.js' %}"></script>
  
    <script src="{% static 'web/js/count-down.js' %}"></script>
 
    <script src="{% static 'web/js/jquery-ui.js' %}"></script>

   
    <script src="{% static 'web/js/main.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.0/dist/sweetalert2.all.min.js"></script>
    {% block js_plugins %}
   
    {% block js %}{% endblock %}
    <script>
        $("#pincodeForm").submit(function(event) {
            event.preventDefault();
            var pincode = $("#pincodeInput").val();
            var csrfToken = $("input[name='csrfmiddlewaretoken']").val();
        
            $.ajax({
                url: "{% url 'web:check_pincode_ajax' %}",
                type: "POST",
                data: { pincode: pincode, csrfmiddlewaretoken: csrfToken },
                success: function(response) {
                    if (response.status === "success") {
                        localStorage.setItem("savedPincode", pincode);
                        window.location.href = window.location.pathname + "?pincode=" + pincode;  // Reload correctly
                    } else {
                        $("#pincodeResult").html(`<p style="color:red;">${response.message}</p>`);
                    }
                }
            });
        });
        
     
        $(document).ready(function() {
            var savedPincode = localStorage.getItem("savedPincode");
            if (savedPincode) {
                $("#pincodeInput").val(savedPincode);
            }
        });
        
            
        
            // Use Current Location
            $("#useCurrentLocation").click(function() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        var lat = position.coords.latitude;
                        var lon = position.coords.longitude;
                        fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`)
                            .then(response => response.json())
                            .then(data => {
                                if (data.postcode) {
                                    $("#pincodeInput").val(data.postcode);
                                } else {
                                    alert("Pincode not found for your location.");
                                }
                            });
                    });
                } else {
                    alert("Geolocation is not supported by this browser.");
                }
            });
        </script>

    <script>
        function toggleDirection() {
            const body = document.body;
            body.setAttribute('dir', body.getAttribute('dir') === 'ltr' ? 'rtl' : 'ltr');
        }
    
        $(document).ready(function () {
            $(".langSelectorOption").click(function () {
            var lang = $(this).data("lang");
                var active_lang = "{{LANGUAGE_CODE}}";
                var url = "{{request.get_full_path}}";
                var new_url = is_lang_active(url, active_lang) ? url.replace(active_lang, lang) : url + lang + "/";
                window.location.href = new_url;
            });
    
            function is_lang_active(url, active_lang) {
                return url.includes(active_lang);
            }
        });
    </script>
    {% endblock %}

    <style>
        /* Lazy loading styles */
        .lazy-load {
          opacity: 0;
          transition: opacity 0.3s ease-in-out;
        }
        
        .lazy-load.loaded {
          opacity: 1;
        }
        
        .lazy-load.loading {
          background: #f0f0f0 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40"><circle cx="20" cy="20" r="18" fill="none" stroke="%23ddd" stroke-width="2"/><circle cx="20" cy="20" r="18" fill="none" stroke="%23007bff" stroke-width="2" stroke-linecap="round" stroke-dasharray="28.26" stroke-dashoffset="28.26"><animate attributeName="stroke-dashoffset" dur="2s" values="28.26;0;28.26" repeatCount="indefinite"/></circle></svg>') center/40px 40px no-repeat;
        }
        </style>
        
        <script>
        document.addEventListener('DOMContentLoaded', function() {
          // Intersection Observer for lazy loading
          const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                const img = entry.target;
                img.classList.add('loading');
                
                // Create a new image to preload
                const imageLoader = new Image();
                imageLoader.onload = function() {
                  img.src = img.dataset.src;
                  img.classList.remove('loading');
                  img.classList.add('loaded');
                  observer.unobserve(img);
                };
                
                imageLoader.onerror = function() {
                  img.classList.remove('loading');
                  // Fallback image or error handling
                  img.src = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="200" height="200"%3E%3Crect width="200" height="200" fill="%23f0f0f0"/%3E%3Ctext x="50%" y="50%" text-anchor="middle" dy=".3em" fill="%23999"%3ENo Image%3C/text%3E%3C/svg%3E';
                  img.classList.add('loaded');
                  observer.unobserve(img);
                };
                
                imageLoader.src = img.dataset.src;
              }
            });
          }, {
            rootMargin: '50px 0px',
            threshold: 0.01
          });
        
          // Observe all lazy load images
          document.querySelectorAll('.lazy-load').forEach(img => {
            imageObserver.observe(img);
          });
        });
        </script>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Hide skeleton and show content when page is fully loaded
                window.addEventListener('load', function() {
                    setTimeout(function() {
                        const skeleton = document.getElementById('skeletonLoader');
                        const content = document.getElementById('mainContent');
                        
                        if (skeleton) {
                            skeleton.classList.add('hidden');
                        }
                        
                        if (content) {
                            content.style.opacity = '1';
                            content.style.transition = 'opacity 0.3s ease-in';
                        }
                    }, 500);
                });
            });
        </script>
        
  
    </body>
</html> 